return {
    Init = function(UI, Core, Notify)
        task.defer(function()
            repeat task.wait() until UI and UI.Sections and UI.Tabs and UI.Tabs.LocalPlayer

            local Players = game:GetService("Players")
            local UIS = game:GetService("UserInputService")
            local RunService = game:GetService("RunService")
            local lp = Players.LocalPlayer

            getgenv().HitboxRoll = false
            local toggleMasterEnabled = false
            local mobileGuiVisible = false
            local minimized = false

            UI.Sections.AntiLock:Header({ Name = "Hitbox Roll" })

            local screenGui = Instance.new("ScreenGui")
            screenGui.Name = "HitboxRollGui"
            screenGui.ResetOnSpawn = false
            screenGui.Enabled = false
            screenGui.Parent = game:GetService("CoreGui")

            local mainFrame = Instance.new("Frame")
            mainFrame.Name = "Main"
            mainFrame.Size = UDim2.new(0, 200, 0, 100)
            mainFrame.Position = UDim2.new(0.5, -100, 0.8, 0)
            mainFrame.BackgroundColor3 = Color3.fromRGB(23, 32, 46)
            mainFrame.BorderSizePixel = 0
            mainFrame.BackgroundTransparency = 0.15
            mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
            mainFrame.Parent = screenGui

            Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)
            local stroke = Instance.new("UIStroke", mainFrame)
            stroke.Color = Color3.fromRGB(80, 130, 255)
            stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

            local dragHandle = Instance.new("Frame")
            dragHandle.Name = "DragHandle"
            dragHandle.Size = UDim2.new(1, 0, 0, 20)
            dragHandle.BackgroundColor3 = Color3.fromRGB(17, 24, 34)
            dragHandle.BackgroundTransparency = 0.2
            dragHandle.BorderSizePixel = 0
            dragHandle.Parent = mainFrame

            local title = Instance.new("TextLabel")
            title.Text = "Hitbox Roll"
            title.Font = Enum.Font.GothamBold
            title.TextSize = 16
            title.TextColor3 = Color3.fromRGB(255, 255, 255)
            title.BackgroundTransparency = 1
            title.Position = UDim2.new(0, 10, 0, 0)
            title.Size = UDim2.new(0.6, 0, 1, 0)
            title.TextXAlignment = Enum.TextXAlignment.Left
            title.Parent = dragHandle

            local minimizeBtn = Instance.new("TextButton")
            minimizeBtn.Text = "➖"
            minimizeBtn.Font = Enum.Font.GothamBold
            minimizeBtn.TextSize = 14
            minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
            minimizeBtn.BackgroundTransparency = 1
            minimizeBtn.Size = UDim2.new(0, 20, 1, 0)
            minimizeBtn.Position = UDim2.new(1, -24, 0, 0)
            minimizeBtn.TextXAlignment = Enum.TextXAlignment.Center
            minimizeBtn.Parent = dragHandle

            local statusLabel = Instance.new("TextButton")
            statusLabel.Text = "⦿ Hitbox Roll: OFF"
            statusLabel.Font = Enum.Font.Gotham
            statusLabel.TextSize = 14
            statusLabel.TextColor3 = Color3.fromRGB(200, 220, 255)
            statusLabel.BackgroundColor3 = Color3.fromRGB(30, 38, 55)
            statusLabel.Position = UDim2.new(0, 10, 0, 30)
            statusLabel.Size = UDim2.new(1, -20, 0, 40)
            statusLabel.TextXAlignment = Enum.TextXAlignment.Left
            statusLabel.Parent = mainFrame
            Instance.new("UICorner", statusLabel).CornerRadius = UDim.new(0, 6)

            minimizeBtn.MouseButton1Click:Connect(function()
                minimized = not minimized
                statusLabel.Visible = not minimized
                mainFrame.Size = minimized and UDim2.new(0, 200, 0, 20) or UDim2.new(0, 200, 0, 80)
                minimizeBtn.Text = minimized and "⿻" or "➖"
            end)

            local dragging, dragStart, startPos = false
            dragHandle.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                    dragStart = input.Position
                    startPos = mainFrame.Position
                end
            end)

            UIS.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local delta = input.Position - dragStart
                    mainFrame.Position = UDim2.new(
                        startPos.X.Scale, startPos.X.Offset + delta.X,
                        startPos.Y.Scale, startPos.Y.Offset + delta.Y
                    )
                end
            end)

            UIS.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)

            statusLabel.MouseButton1Click:Connect(function()
                if not toggleMasterEnabled then
                    Notify("Hitbox Roll", "Enable from toggle first!", 2)
                    return
                end
                getgenv().HitboxRoll = not getgenv().HitboxRoll
                statusLabel.Text = getgenv().HitboxRoll and "⦿ Hitbox Roll: ON" or "⦿ Hitbox Roll: OFF"
                Notify("Hitbox Roll", getgenv().HitboxRoll and "Enabled" or "Disabled", 2)
            end)

            UI.Sections.AntiLock:Toggle({
                Name = "Hitbox Roll",
                Default = false,
                Callback = function(state)
                    toggleMasterEnabled = state
                    getgenv().HitboxRoll = false
                    screenGui.Enabled = toggleMasterEnabled and mobileGuiVisible
                    statusLabel.Text = "⦿ Hitbox Roll: OFF"
                    Notify("Hitbox Roll", state and "Ready" or "Disabled", 2)
                end
            }, "HitboxRoll")

            UI.Sections.AntiLock:Toggle({
                Name = "Show Mobile Gui",
                Default = false,
                Callback = function(state)
                    mobileGuiVisible = state
                    screenGui.Enabled = toggleMasterEnabled and mobileGuiVisible
                end
            }, "HitboxRollGuiToggle")

            UI.Sections.AntiLock:Keybind({
                Name = "Toggle Key",
                Mode = "Toggle",
                Default = Enum.KeyCode.H,
                Callback = function()
                    if not toggleMasterEnabled then return end
                    getgenv().HitboxRoll = not getgenv().HitboxRoll
                    statusLabel.Text = getgenv().HitboxRoll and "⦿ Hitbox Roll: ON" or "⦿ Hitbox Roll: OFF"
                end
            }, "HitboxRollKey")

            local lastUpdate = 0
            local updateInterval = 0.05 -- Reduced from every frame to 20 FPS
            local velocitySpooferEnabled = true
            
            local velocityPatterns = {
                {X = 50, Y = 120, Z = 30},
                {X = -30, Y = -80, Z = 50},
                {X = 70, Y = 150, Z = -40},
                {X = -50, Y = -120, Z = -30},
                {X = 25, Y = 200, Z = 60}
            }
            
            local currentPattern = 1
            local patternChangeTime = 0
            local patternChangeInterval = 0.3 

            RunService.Heartbeat:Connect(function()
                if not getgenv().HitboxRoll then return end
                
                local now = tick()
                if now - lastUpdate < updateInterval then return end
                lastUpdate = now
                
                local char = lp.Character
                if not char then return end

                local hrp = char:FindFirstChild("HumanoidRootPart")
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if not hrp or not humanoid or humanoid.Health <= 0 then return end

                if hrp:CanSetNetworkOwnership() then
                    pcall(function() hrp:SetNetworkOwner(nil) end)
                end

                if now - patternChangeTime > patternChangeInterval then
                    patternChangeTime = now
                    currentPattern = (currentPattern % #velocityPatterns) + 1
                end

                local pattern = velocityPatterns[currentPattern]
                local originalPos = hrp.Position
                local originalVel = hrp.AssemblyLinearVelocity

                if velocitySpooferEnabled then
                    hrp.AssemblyLinearVelocity = Vector3.new(
                        pattern.X + math.random(-20, 20),
                        pattern.Y + math.random(-30, 30),
                        pattern.Z + math.random(-20, 20)
                    )
                end

                local time = tick()
                local offset = Vector3.new(
                    math.sin(time * 8) * 1.5,  -- Reduced from 4
                    math.cos(time * 6) * 1,    -- Reduced from 2.5
                    math.cos(time * 8) * 1.5   -- Reduced from 4
                )

                char:PivotTo(hrp.CFrame + offset)
                task.defer(function()
                    if char and hrp then
                        char:PivotTo(CFrame.new(originalPos))
                        if velocitySpooferEnabled then
                            hrp.AssemblyLinearVelocity = originalVel
                        end
                    end
                end)
            end)

            local OldIndex
            OldIndex = hookmetamethod(game, "__index", function(self, key)
                if not getgenv().HitboxRoll or checkcaller() then
                    return OldIndex(self, key)
                end

                if key == "CFrame" and lp.Character then
                    local hrp = lp.Character:FindFirstChild("HumanoidRootPart")
                    local humanoid = lp.Character:FindFirstChildOfClass("Humanoid")
                    
                    if hrp and humanoid and humanoid.Health > 0 then
                        if self == hrp then
                            return hrp.CFrame
                        elseif self == lp.Character.Head then
                            return hrp.CFrame + Vector3.new(0, 2.5, 0)
                        end
                    end
                end
                
                return OldIndex(self, key)
            end)
        end)
    end
}
