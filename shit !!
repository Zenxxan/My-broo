return {
    Init = function(UI, Core, Notify)
        task.defer(function()
            repeat task.wait() until UI and UI.Sections and UI.Tabs and UI.Tabs.LocalPlayer
            local Players = game:GetService("Players")
            local UIS = game:GetService("UserInputService")
            local RunService = game:GetService("RunService")
            local lp = Players.LocalPlayer
            getgenv().HitboxRoll = false
            local toggleMasterEnabled = false
            local mobileGuiVisible = false
            local minimized = false
            UI.Sections.AntiLock:Header({ Name = "Hitbox Roll" })
            local screenGui = Instance.new("ScreenGui")
            screenGui.Name = "HitboxRollGui"
            screenGui.ResetOnSpawn = false
            screenGui.Enabled = false
            pcall(function() screenGui.Parent = game.CoreGui end)
            local mainFrame = Instance.new("Frame")
            mainFrame.Size = UDim2.new(0, 200, 0, 100)
            mainFrame.Position = UDim2.new(0.5, -100, 0.8, 0)
            mainFrame.BackgroundColor3 = Color3.fromRGB(23, 32, 46)
            mainFrame.BorderSizePixel = 0
            mainFrame.BackgroundTransparency = 0.15
            mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
            mainFrame.Parent = screenGui
            Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)
            local stroke = Instance.new("UIStroke", mainFrame)
            stroke.Color = Color3.fromRGB(80, 130, 255)
            stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            local dragHandle = Instance.new("Frame")
            dragHandle.Size = UDim2.new(1, 0, 0, 20)
            dragHandle.BackgroundColor3 = Color3.fromRGB(17, 24, 34)
            dragHandle.BackgroundTransparency = 0.2
            dragHandle.BorderSizePixel = 0
            dragHandle.Parent = mainFrame
            local dragLabel = Instance.new("TextLabel")
            dragLabel.Text = "➕"
            dragLabel.Font = Enum.Font.GothamBold
            dragLabel.TextSize = 14
            dragLabel.TextColor3 = Color3.new(1,1,1)
            dragLabel.BackgroundTransparency = 1
            dragLabel.Size = UDim2.new(0, 20, 1, 0)
            dragLabel.Position = UDim2.new(1, -44, 0, 0)
            dragLabel.TextXAlignment = Enum.TextXAlignment.Center
            dragLabel.Parent = dragHandle
            local minimizeBtn = Instance.new("TextButton")
            minimizeBtn.Text = "➖"
            minimizeBtn.Font = Enum.Font.GothamBold
            minimizeBtn.TextSize = 14
            minimizeBtn.TextColor3 = Color3.new(1,1,1)
            minimizeBtn.BackgroundTransparency = 1
            minimizeBtn.Size = UDim2.new(0, 20, 1, 0)
            minimizeBtn.Position = UDim2.new(1, -24, 0, 0)
            minimizeBtn.TextXAlignment = Enum.TextXAlignment.Center
            minimizeBtn.Parent = dragHandle
            local title = Instance.new("TextLabel")
            title.Text = "Hitbox Roll"
            title.Font = Enum.Font.GothamBold
            title.TextSize = 16
            title.TextColor3 = Color3.new(1,1,1)
            title.BackgroundTransparency = 1
            title.Position = UDim2.new(0, 10, 0, 5)
            title.Size = UDim2.new(1, -20, 0, 20)
            title.TextXAlignment = Enum.TextXAlignment.Left
            title.Parent = mainFrame
            local statusLabel = Instance.new("TextButton")
            statusLabel.Text = "⦿ Hitbox Roll: OFF"
            statusLabel.Font = Enum.Font.Gotham
            statusLabel.TextSize = 14
            statusLabel.TextColor3 = Color3.fromRGB(200, 220, 255)
            statusLabel.BackgroundColor3 = Color3.fromRGB(30, 38, 55)
            statusLabel.Position = UDim2.new(0, 10, 0, 35)
            statusLabel.Size = UDim2.new(1, -20, 0, 40)
            statusLabel.TextXAlignment = Enum.TextXAlignment.Left
            statusLabel.Parent = mainFrame
            Instance.new("UICorner", statusLabel).CornerRadius = UDim.new(0, 6)
            minimizeBtn.MouseButton1Click:Connect(function()
                minimized = not minimized
                statusLabel.Visible = not minimized
                mainFrame.Size = minimized and UDim2.new(0, 200, 0, 30) or UDim2.new(0, 200, 0, 100)
                minimizeBtn.Text = minimized and "⿻" or "➖"
            end)
            local dragging, dragStart, startPos, inputConn
            local function onInputChanged(input)
                if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    local delta = input.Position - dragStart
                    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
                end
            end
            local function onInputEnded()
                dragging = false
                if inputConn then inputConn:Disconnect() inputConn = nil end
            end
            dragHandle.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    dragStart = input.Position
                    startPos = mainFrame.Position
                    if inputConn then inputConn:Disconnect() end
                    inputConn = input.Changed:Connect(function()
                        if input.UserInputState == Enum.UserInputState.End then onInputEnded() end
                    end)
                end
            end)
            UIS.InputChanged:Connect(onInputChanged)
            statusLabel.MouseButton1Click:Connect(function()
                if not toggleMasterEnabled then Notify("Hitbox Roll", "Enable from toggle first!", 2) return end
                getgenv().HitboxRoll = not getgenv().HitboxRoll
                statusLabel.Text = getgenv().HitboxRoll and "⦿ Hitbox Roll: ON" or "⦿ Hitbox Roll: OFF"
                Notify("Hitbox Roll", getgenv().HitboxRoll and "Enabled (Mobile)" or "Disabled (Mobile)", 2)
            end)
            UI.Sections.AntiLock:Toggle({
                Name = "Hitbox Roll",
                Default = false,
                Callback = function(state)
                    toggleMasterEnabled = state
                    getgenv().HitboxRoll = false
                    screenGui.Enabled = toggleMasterEnabled and mobileGuiVisible
                    statusLabel.Text = "⦿ Hitbox Roll: OFF"
                    Notify("Hitbox Roll", state and "Ready for Mobile Use" or "Disabled", 2)
                end
            }, "HitboxRoll")
            UI.Sections.AntiLock:Toggle({
                Name = "Show Mobile Gui",
                Default = false,
                Callback = function(state)
                    mobileGuiVisible = state
                    screenGui.Enabled = toggleMasterEnabled and mobileGuiVisible
                    Notify("Mobile GUI", state and "Shown" or "Hidden", 2)
                end
            }, "HitboxRollGuiToggle")
            UI.Sections.AntiLock:Keybind({
                Name = "Toggle Hitbox Roll Key",
                Mode = "Toggle",
                Default = Enum.KeyCode.H,
                Callback = function()
                    if not toggleMasterEnabled then Notify("Hitbox Roll", "Enable Hitbox Roll first!", 2) return end
                    getgenv().HitboxRoll = not getgenv().HitboxRoll
                    statusLabel.Text = getgenv().HitboxRoll and "⦿ Hitbox Roll: ON" or "⦿ Hitbox Roll: OFF"
                    Notify("Hitbox Roll", getgenv().HitboxRoll and "Enabled (Keybind)" or "Disabled (Keybind)", 2)
                end
            }, "HitboxRollKey")

            local orbitRadius, rollSpeed = 4, 1440
            local flickerAmplitude = 1.5
            local velocityRangeY = 250
            local fakeAngleSpeed = 720
            local originalCFrame, originalVelocity, fakeCFrame, fakeVel
            local lastUpdate = 0
            local updateInterval = 1/90
            local bodyParts = {"UpperTorso", "LowerTorso", "LeftUpperArm", "LeftLowerArm", "LeftHand", "RightUpperArm", "RightLowerArm", "RightHand", "LeftUpperLeg", "LeftLowerLeg", "LeftFoot", "RightUpperLeg", "RightLowerLeg", "RightFoot"}

            RunService.Heartbeat:Connect(function()
                if not getgenv().HitboxRoll then return end
                local now = tick()
                if now - lastUpdate < updateInterval then return end
                lastUpdate = now

                local char = lp.Character
                if not char or not char:FindFirstChild("HumanoidRootPart") or not char:FindFirstChild("Humanoid") or char.Humanoid.Health <= 0 then return end
                local hrp = char.HumanoidRootPart

                originalCFrame = hrp.CFrame
                originalVelocity = hrp.AssemblyLinearVelocity

                pcall(function() hrp:SetNetworkOwner(lp) end)

                local angle = now * math.pi * 4
                local orbitOffset = Vector3.new(math.cos(angle) * orbitRadius, math.sin(angle * 1.5) * orbitRadius * 0.5, math.sin(angle) * orbitRadius)
                local flickerOffset = Vector3.new(math.random(-150,150)/100, math.random(-150,150)/100, math.random(-150,150)/100) * flickerAmplitude
                local totalOffset = orbitOffset + flickerOffset
                local rollAngle = math.rad(now * rollSpeed % 360)
                local rollCF = CFrame.Angles(rollAngle, rollAngle, rollAngle)

                local fakeAngle = math.rad(now * fakeAngleSpeed % 360)
                fakeCFrame = originalCFrame * CFrame.Angles(0, fakeAngle, 0)
                fakeVel = Vector3.new(math.random(-50,50), math.random(-120,120), math.random(-50,50))

                local newCF = originalCFrame * rollCF * CFrame.new(totalOffset)
                char:PivotTo(newCF)

                local spoofY = math.clamp(math.random(-velocityRangeY, velocityRangeY), -120, 120)
                hrp.AssemblyLinearVelocity = Vector3.new(originalVelocity.X, spoofY, originalVelocity.Z)

                task.spawn(function()
                    RunService.RenderStepped:Wait()
                    if originalCFrame then char:PivotTo(originalCFrame) end
                    if originalVelocity then hrp.AssemblyLinearVelocity = originalVelocity end
                end)
            end)

            local OldIndex
            OldIndex = hookmetamethod(game, "__index", newcclosure(function(self, key)
                if getgenv().HitboxRoll and not checkcaller() and lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
                    if key == "CFrame" then
                        if self == lp.Character.HumanoidRootPart then
                            return originalCFrame or self.CFrame
                        elseif self == lp.Character.Head then
                            return (originalCFrame or self.CFrame) + Vector3.new(0, lp.Character.HumanoidRootPart.Size.Y / 2 + 0.5, 0)
                        elseif table.find(bodyParts, self.Name) then
                            return (originalCFrame or self.CFrame) * CFrame.Angles(math.rad(math.random(-45,45)), math.rad(math.random(-90,90)), math.rad(math.random(-45,45)))
                        end
                    elseif key == "AssemblyLinearVelocity" or key == "Velocity" then
                        if self == lp.Character.HumanoidRootPart then
                            return fakeVel or self[key]
                        end
                    elseif key == "HipHeight" and self == lp.Character.Humanoid then
                        return 2 + math.sin(tick() * 10) * 0.5
                    end
                end
                return OldIndex(self, key)
            end))

            local OldNamecall
            OldNamecall = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
                local method = getnamecallmethod()
                local args = {...}
                if getgenv().HitboxRoll and not checkcaller() then
                    if method == "GetPropertyChangedSignal" and (self == lp.Character.HumanoidRootPart or self == lp.Character.Head or table.find(bodyParts, self.Name)) and (args[1] == "CFrame" or args[1] == "AssemblyLinearVelocity") then
                        return {Connect = function() end}
                    elseif (method == "FindPartOnRayWithIgnoreList" or method == "Raycast" or method == "RaycastWithInstance") then
                        if args[1] and args[1].Origin and args[1].Direction then
                            local ray = args[1]
                            local predictedPos = ray.Origin + ray.Direction * 0.1
                            if (predictedPos - (originalCFrame or lp.Character.HumanoidRootPart.CFrame).Position).Magnitude < 25 then
                                return nil
                            end
                        end
                    elseif method == "GetChildren" or method == "GetDescendants" then
                        if self == lp.Character then
                            local children = OldNamecall(self, ...)
                            local filtered = {}
                            for _, child in pairs(children) do
                                if child == lp.Character.HumanoidRootPart or child == lp.Character.Head then
                                    table.insert(filtered, child)
                                end
                            end
                            return filtered
                        end
                    elseif method == "FireServer" and self.Name:find("RemoteEvent") and string.find(self.Name:lower(), "aim" or "hit" or "shoot") then
                        return
                    end
                end
                return OldNamecall(self, unpack(args))
            end))

            local OldNewIndex
            OldNewIndex = hookmetamethod(game, "__newindex", newcclosure(function(self, key, value)
                if getgenv().HitboxRoll and not checkcaller() and self == lp.Character.HumanoidRootPart and (key == "CFrame" or key == "AssemblyLinearVelocity") then
                    return
                end
                return OldNewIndex(self, key, value)
            end))

            local OldGetProperty
            OldGetProperty = hookmetamethod(game, "__index", newcclosure(function(self, key)
                if getgenv().HitboxRoll and not checkcaller() then
                    if key == "Rotation" and self == lp.Character.HumanoidRootPart then
                        return fakeCFrame.Rotation
                    elseif key == "LookVector" and self == lp.Character.HumanoidRootPart then
                        return fakeCFrame.LookVector
                    elseif key == "Position" and (self == lp.Character.HumanoidRootPart or self == lp.Character.Head) then
                        return (originalCFrame or self.CFrame).Position + Vector3.new(math.random(-2,2), math.random(-1,1), math.random(-2,2))
                    end
                end
                return OldGetProperty(self, key)
            end))

            local mt = getrawmetatable(game)
            local oldNamecall = mt.__namecall
            local oldIndex = mt.__index
            setreadonly(mt, false)

            mt.__namecall = newcclosure(function(self, ...)
                return OldNamecall(self, ...)
            end)

            mt.__index = newcclosure(function(self, key)
                return OldIndex(self, key)
            end)

            mt.__newindex = newcclosure(function(self, key, value)
                return OldNewIndex(self, key, value)
            end)

            setreadonly(mt, true)
        end)
    end
}
