return {
    Init = function(UI, Core, Notify)
        task.defer(function()
            repeat task.wait() until UI and UI.Sections and UI.Tabs and UI.Tabs.LocalPlayer

            local Players = game:GetService("Players")
            local UIS = game:GetService("UserInputService")
            local RunService = game:GetService("RunService")
            local lp = Players.LocalPlayer

            getgenv().HitboxRoll = false
            local toggleMasterEnabled = false
            local mobileGuiVisible = false

            UI.Sections.AntiLock:Header({ Name = "Hitbox Roll" })

            local screenGui = Instance.new("ScreenGui")
            screenGui.Name = "HitboxRollGui"
            screenGui.ResetOnSpawn = false
            screenGui.Enabled = false
            screenGui.IgnoreGuiInset = true
            pcall(function()
                screenGui.Parent = game:GetService("CoreGui")
            end)

            local mainFrame = Instance.new("Frame")
            mainFrame.Name = "Main"
            mainFrame.Size = UDim2.new(0, 200, 0, 100)
            mainFrame.Position = UDim2.new(0.5, -100, 0.8, 0)
            mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
            mainFrame.BorderSizePixel = 0
            mainFrame.BackgroundTransparency = 0.1
            mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
            mainFrame.Parent = screenGui

            Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)
            Instance.new("UIStroke", mainFrame).Color = Color3.fromRGB(60, 60, 255)

            local dragHandle = Instance.new("Frame")
            dragHandle.Name = "DragHandle"
            dragHandle.Size = UDim2.new(1, 0, 0, 24)
            dragHandle.Position = UDim2.new(0, 0, 0, 0)
            dragHandle.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
            dragHandle.BackgroundTransparency = 0.1
            dragHandle.BorderSizePixel = 0
            dragHandle.Parent = mainFrame
            Instance.new("UICorner", dragHandle).CornerRadius = UDim.new(0, 8)

            local dragIcon = Instance.new("TextLabel")
            dragIcon.Text = "☰"
            dragIcon.Font = Enum.Font.GothamBold
            dragIcon.TextSize = 14
            dragIcon.TextColor3 = Color3.fromRGB(180, 180, 180)
            dragIcon.BackgroundTransparency = 1
            dragIcon.Size = UDim2.new(0, 24, 1, 0)
            dragIcon.Position = UDim2.new(0, 6, 0, 0)
            dragIcon.TextXAlignment = Enum.TextXAlignment.Center
            dragIcon.TextYAlignment = Enum.TextYAlignment.Center
            dragIcon.Parent = dragHandle

            local minimizeBtn = Instance.new("TextButton")
            minimizeBtn.Text = "➖"
            minimizeBtn.Font = Enum.Font.Gotham
            minimizeBtn.TextSize = 14
            minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
            minimizeBtn.BackgroundTransparency = 1
            minimizeBtn.Size = UDim2.new(0, 24, 1, 0)
            minimizeBtn.Position = UDim2.new(1, -28, 0, 0)
            minimizeBtn.Parent = dragHandle

            local title = Instance.new("TextLabel")
            title.Text = "Hitbox Roll"
            title.Font = Enum.Font.GothamBold
            title.TextSize = 16
            title.TextColor3 = Color3.fromRGB(255, 255, 255)
            title.BackgroundTransparency = 1
            title.Position = UDim2.new(0, 34, 0, 0)
            title.Size = UDim2.new(1, -60, 0, 24)
            title.TextXAlignment = Enum.TextXAlignment.Left
            title.Parent = dragHandle

            local statusLabel = Instance.new("TextButton")
            statusLabel.Text = "⦿ Hitbox Roll: OFF"
            statusLabel.Font = Enum.Font.Gotham
            statusLabel.TextSize = 14
            statusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
            statusLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            statusLabel.Position = UDim2.new(0, 10, 0, 35)
            statusLabel.Size = UDim2.new(1, -20, 0, 40)
            statusLabel.TextXAlignment = Enum.TextXAlignment.Left
            statusLabel.Parent = mainFrame
            Instance.new("UICorner", statusLabel).CornerRadius = UDim.new(0, 6)

            -- Drag logic (fixed)
            local dragging, dragStart, startPos, inputConn
            local function endDrag()
                dragging = false
                if inputConn then
                    inputConn:Disconnect()
                    inputConn = nil
                end
            end

            dragHandle.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    dragStart = input.Position
                    startPos = mainFrame.Position
                    if inputConn then inputConn:Disconnect() end
                    inputConn = input.Changed:Connect(function()
                        if input.UserInputState == Enum.UserInputState.End then
                            endDrag()
                        end
                    end)
                end
            end)

            UIS.InputChanged:Connect(function(input)
                if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    local delta = input.Position - dragStart
                    mainFrame.Position = UDim2.new(
                        startPos.X.Scale,
                        startPos.X.Offset + delta.X,
                        startPos.Y.Scale,
                        startPos.Y.Offset + delta.Y
                    )
                end
            end)

            minimizeBtn.MouseButton1Click:Connect(function()
                mainFrame.Visible = not mainFrame.Visible
            end)

            -- Toggle logic
            statusLabel.MouseButton1Click:Connect(function()
                if not toggleMasterEnabled then
                    Notify("Hitbox Roll", "Enable from PC toggle first!", 2)
                    return
                end
                getgenv().HitboxRoll = not getgenv().HitboxRoll
                statusLabel.Text = getgenv().HitboxRoll and "⦿ Hitbox Roll: ON" or "⦿ Hitbox Roll: OFF"
                Notify("Hitbox Roll", getgenv().HitboxRoll and "Enabled (Mobile)" or "Disabled (Mobile)", 2)
            end)

            UI.Sections.AntiLock:Toggle({
                Name = "Hitbox Roll",
                Default = false,
                Callback = function(state)
                    toggleMasterEnabled = state
                    getgenv().HitboxRoll = false
                    screenGui.Enabled = toggleMasterEnabled and mobileGuiVisible
                    statusLabel.Text = "⦿ Hitbox Roll: OFF"
                    Notify("Hitbox Roll", state and "Ready for Mobile Use" or "Disabled", 2)
                end
            }, "HitboxRoll")

            UI.Sections.AntiLock:Toggle({
                Name = "Show Mobile Button",
                Default = false,
                Callback = function(state)
                    mobileGuiVisible = state
                    screenGui.Enabled = toggleMasterEnabled and mobileGuiVisible
                    Notify("Mobile GUI", state and "Shown" or "Hidden", 2)
                end
            }, "HitboxRollGuiToggle")

            UI.Sections.AntiLock:Keybind({
                Name = "Toggle Hitbox Roll Key",
                Mode = "Toggle",
                Default = Enum.KeyCode.H,
                Callback = function()
                    if not toggleMasterEnabled then
                        Notify("Hitbox Roll", "Enable Hitbox Roll first!", 2)
                        return
                    end
                    getgenv().HitboxRoll = not getgenv().HitboxRoll
                    statusLabel.Text = getgenv().HitboxRoll and "⦿ Hitbox Roll: ON" or "⦿ Hitbox Roll: OFF"
                    Notify("Hitbox Roll", getgenv().HitboxRoll and "Enabled (Keybind)" or "Disabled (Keybind)", 2)
                end
            }, "HitboxRollKey")

            -- Orbit/flicker logic
            local orbitRadius, rollSpeed = 4, 1440
            local flickerAmplitude, spoofYVelocity = 1.5, true
            local velocityRangeY = 250
            local originalCFrame, originalVelocity

            RunService.Heartbeat:Connect(function()
                if getgenv().HitboxRoll then
                    local char = lp.Character
                    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
                    local hrp = char.HumanoidRootPart
                    originalCFrame = hrp.CFrame
                    originalVelocity = hrp.AssemblyLinearVelocity
                    pcall(function() hrp:SetNetworkOwner(lp) end)

                    local angle = tick() * math.pi * 4
                    local orbitOffset = Vector3.new(
                        math.cos(angle) * orbitRadius,
                        math.sin(angle * 1.5) * orbitRadius * 0.5,
                        math.sin(angle) * orbitRadius
                    )

                    local flickerOffset = Vector3.new(
                        math.random(-flickerAmplitude * 100, flickerAmplitude * 100) / 100,
                        math.random(-flickerAmplitude * 100, flickerAmplitude * 100) / 100,
                        math.random(-flickerAmplitude * 100, flickerAmplitude * 100) / 100
                    )

                    local totalOffset = orbitOffset + flickerOffset
                    local rollAngle = math.rad(tick() * rollSpeed % 360)
                    local rollCF = CFrame.Angles(rollAngle, rollAngle, rollAngle)

                    hrp.CFrame = hrp.CFrame * rollCF * CFrame.new(totalOffset)

                    if spoofYVelocity then
                        hrp.AssemblyLinearVelocity = Vector3.new(
                            originalVelocity.X,
                            math.random(-velocityRangeY, velocityRangeY),
                            originalVelocity.Z
                        )
                    end

                    RunService.RenderStepped:Wait()
                    hrp.CFrame = originalCFrame
                    hrp.AssemblyLinearVelocity = originalVelocity
                end
            end)

            local OldIndex
            OldIndex = hookmetamethod(game, "__index", newcclosure(function(self, key)
                if getgenv().HitboxRoll and not checkcaller() then
                    if key == "CFrame"
                        and lp.Character
                        and lp.Character:FindFirstChild("HumanoidRootPart")
                        and lp.Character:FindFirstChild("Humanoid")
                        and lp.Character.Humanoid.Health > 0 then

                        if self == lp.Character.HumanoidRootPart then
                            return originalCFrame or CFrame.new()
                        elseif self == lp.Character.Head then
                            return (originalCFrame or CFrame.new()) + Vector3.new(0, lp.Character.HumanoidRootPart.Size.Y / 2 + 0.5, 0)
                        end
                    end
                end
                return OldIndex(self, key)
            end))
        end)
    end
}
